<div class="medical-records-page bg-background min-h-screen p-4 md:p-6 lg:p-8">
    
  <div class="page-main-header flex flex-col md:flex-row justify-between items-start md:items-center mb-6 md:mb-8 p-4 bg-card rounded-card shadow-card">
    <div class="header-title-section mb-4 md:mb-0">
      <h1 class="text-dashboard-title font-display text-text">Medical Records</h1>
      <p class="text-body text-text-light">Complete access to your medical history</p>
    </div>
    <div class="header-actions flex space-x-3">
      <button (click)="exportRecords()" class="btn-secondary flex items-center bg-card hover:bg-hover text-text-light font-medium py-2 px-4 rounded-button border border-border shadow-sm transition-colors duration-150">
        <i class="fas fa-upload mr-2"></i> Export
      </button>
      <button (click)="requestRecords()" class="btn-primary flex items-center bg-primary hover:bg-primary-dark text-white font-medium py-2 px-4 rounded-button shadow-sm hover:shadow-md transition-all duration-150">
        <i class="fas fa-plus-circle mr-2"></i> Request Records
      </button>
    </div>
  </div>
    
<div class="filter-bar flex flex-col md:flex-row justify-between items-center mb-6 p-4 bg-card rounded-card shadow-card">
  <div class="search-input-container relative w-full md:w-2/3 mb-4 md:mb-0">
    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
    <input type="text" placeholder="Search records by title, doctor, or description..."
           [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
           class="w-full pl-10 pr-4 py-2.5 border border-border rounded-input text-body text-text focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-shadow">
  </div>
  <div class="filter-actions flex space-x-3 w-full md:w-auto justify-end">
    <button class="btn-filter flex items-center bg-card hover:bg-hover text-text-light font-medium py-2 px-4 rounded-button border border-border shadow-sm transition-colors duration-150">
      <i class="fas fa-calendar-alt mr-2"></i> Date
    </button>
    
    <button class="btn-filter flex items-center bg-card hover:bg-hover text-text-light font-medium py-2 px-4 rounded-button border border-border shadow-sm transition-colors duration-150">
      <i class="fas fa-filter mr-2"></i> Filters
    </button>
  </div>
</div>

 <div class="tabs-container flex space-x-1 mb-6 p-1 bg-gray-200 rounded-lg shadow-inner">
  <button 
    *ngFor="let tab of ['All', 'Examination', 'LabResult', 'Image', 'Prescription']"
    [class.bg-primary]="activeTab === tab"
    [class.text-white]="activeTab === tab"
    [class.text-text-light]="activeTab !== tab"
    [class.hover:bg-primary-light]="activeTab !== tab"
    [class.hover:text-white]="activeTab !== tab"
    (click)="setActiveTab(tab)"
    class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary/50">
    {{ tab === 'LabResult' ? 'Lab Results' : (tab === 'All' ? 'All Records' : tab + 's') }}
  </button>
</div>
  
 <div class="records-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" *ngIf="filteredRecords.length > 0; else noRecords">
  <div class="record-card bg-card rounded-card shadow-card hover:shadow-card-hover transition-shadow duration-150 flex flex-col overflow-hidden" *ngFor="let record of filteredRecords">
    <div class="card-header p-card-padding border-b border-border flex justify-between items-start">
      <h4 class="record-title text-card-title font-display text-text">{{ record.title }}</h4>
      <span class="record-tag text-xs font-semibold px-2 py-1 rounded-full" [ngClass]="record.tagClass">{{ record.tagText }}</span>
    </div>
    <div class="p-card-padding flex-grow">
      <p class="record-date text-xs text-text-muted mb-2 flex items-center"><i class="far fa-calendar-alt mr-2"></i> {{ record.recordDate | date:'mediumDate' }}</p>
      <p class="record-doctor text-sm text-text-light mb-2 flex items-center" *ngIf="record.doctor"><i class="fas fa-user-md mr-2 text-primary"></i> {{ record.doctor }}</p>
      <p class="record-summary text-body text-text-light leading-comfortable line-clamp-3">{{ record.summary }}</p>
    </div>
    <div class="p-card-padding border-t border-border mt-auto">
      <button class="btn-view-details w-full bg-accent hover:bg-accent-dark text-white font-medium py-2.5 px-4 rounded-button transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-accent/50" (click)="openModal(record)">
          View Details
      </button>
    </div>
  </div>
</div>
<ng-template #noRecords>
  <div class="no-records-message flex flex-col items-center justify-center text-center py-16 bg-card rounded-card shadow-card">
    <i class="fas fa-folder-open text-5xl text-text-muted mb-4"></i>
    <p class="text-section-header text-text-light">No medical records found.</p>
    <p class="text-body text-text-muted">Try adjusting your search or filter criteria.</p>
  </div>
</ng-template>


<div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 transition-opacity duration-300" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-content bg-card rounded-card shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden transform transition-all duration-300 ease-out" 
       [class.scale-100]="isModalOpen" [class.opacity-100]="isModalOpen" 
       [class.scale-95]="!isModalOpen" [class.opacity-0]="!isModalOpen" 
       (click)="$event.stopPropagation()">
    <div class="modal-header flex justify-between items-center p-card-padding border-b border-border">
      <div>
        <h3 class="modal-title-main text-section-header font-display text-text">Medical Record Details</h3>
        <p class="modal-subtitle text-body text-text-light">View detailed information about this medical record</p>
      </div>
      <button class="btn-close-modal text-text-muted hover:text-text transition-colors" (click)="closeModal()"><i class="fas fa-times text-xl"></i></button>
    </div>
    <div class="modal-body p-card-padding overflow-y-auto space-y-5" *ngIf="selectedRecord">
      <div class="record-main-info flex items-start space-x-4 p-4 bg-hover rounded-md">
        <i [class]="getRecordIconClass(selectedRecord.type)" class="fas fa-file-alt text-3xl text-primary mt-1"></i>  
        <div class="flex-grow">
          <h4 class="record-title-modal text-card-title font-display text-text">{{ selectedRecord.title }}</h4>
          <p class="record-date-modal text-sm text-text-light">{{ selectedRecord.recordDate | date:'fullDate' }}</p>
        </div>
      </div>

      <div class="info-section" *ngIf="selectedRecord.doctor">
        <label class="block text-sm font-medium text-text-light mb-1">Doctor</label>
        <p class="text-body text-text flex items-center"><i class="fas fa-user-md mr-2 text-primary"></i> {{ selectedRecord.doctor }}</p>
      </div>

      <div class="info-section">
        <label class="block text-sm font-medium text-text-light mb-1">Details</label>
        <p class="details-text-box text-body text-text bg-gray-50 p-3 rounded-md border border-border leading-comfortable whitespace-pre-wrap">{{ selectedRecord.details }}</p>
      </div>
      
       <ng-container [ngSwitch]="selectedRecord.type">
        <ng-template [ngSwitchCase]="'LabResult'">
          <div class="info-section" *ngIf="selectedRecord.resultDate">
            <label class="block text-sm font-medium text-text-light mb-1">Result Date</label>
            <p class="text-body text-text flex items-center"><i class="far fa-calendar-check mr-2 text-status-success"></i> {{ selectedRecord.resultDate | date:'mediumDate' }}</p>
          </div>
          <div class="info-section" *ngIf="selectedRecord.performedBy">
            <label class="block text-sm font-medium text-text-light mb-1">Performed By</label>
            <p class="text-body text-text flex items-center"><i class="fas fa-flask mr-2 text-accent"></i> {{ selectedRecord.performedBy }}</p>
          </div>
        </ng-template>

        <ng-template [ngSwitchCase]="'Image'">
          <div class="info-section" *ngIf="selectedRecord.imageDetails">
            <label class="block text-sm font-medium text-text-light mb-1">Image Details</label>
            <p class="text-body text-text">{{ selectedRecord.imageDetails }}</p>
          </div>
          <div class="info-section" *ngIf="selectedRecord.takenBy">
            <label class="block text-sm font-medium text-text-light mb-1">Taken By</label>
            <p class="text-body text-text flex items-center"><i class="fas fa-camera-retro mr-2 text-accent"></i> {{ selectedRecord.takenBy }}</p>
          </div>
          <div class="image-preview-container mt-3" *ngIf="selectedRecord.imageUrl">
            <label class="block text-sm font-medium text-text-light mb-1">Image Preview</label>
           <div class="image-placeholder w-full h-64 bg-gray-100 border border-border rounded-md flex items-center justify-center text-text-muted overflow-hidden">
              <img *ngIf="selectedRecord.imageUrl && selectedRecord.imageUrl !== 'assets/images/xray-chest-placeholder.png' && selectedRecord.imageUrl !== 'assets/images/mri-knee-placeholder.png'" 
                   [src]="selectedRecord.imageUrl" 
                   alt="Medical Image for {{ selectedRecord.title }}" 
                   class="max-w-full max-h-full object-contain rounded-md">
              <div *ngIf="!selectedRecord.imageUrl || selectedRecord.imageUrl === 'assets/images/xray-chest-placeholder.png' || selectedRecord.imageUrl === 'assets/images/mri-knee-placeholder.png'" class="text-center">
                  <i class="fas fa-image text-4xl mb-2"></i>
                  <span class="block text-sm">Image Preview Unavailable</span>
              </div>
            </div>
          </div>
        </ng-template>
      </ng-container>
    </div>
    <div class="modal-footer flex justify-end space-x-3 p-card-padding border-t border-border">
      <button class="btn-secondary bg-card hover:bg-hover text-text-light font-medium py-2 px-4 rounded-button border border-border shadow-sm transition-colors duration-150" (click)="closeModal()">Cancel</button>
      <button class="btn-primary flex items-center bg-primary hover:bg-primary-dark text-white font-medium py-2 px-4 rounded-button shadow-sm hover:shadow-md transition-all duration-150" (click)="downloadRecord(selectedRecord)">
        <i class="fas fa-download mr-2"></i>
        {{ selectedRecord?.type === 'LabResult' ? 'Download Lab Report' : 'Download Record' }}
      </button>
    </div>
  </div>
</div>
</div>